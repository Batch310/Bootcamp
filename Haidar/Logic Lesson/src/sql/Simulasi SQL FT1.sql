--NOMOR 1 STATUS KARYAWAN DAN JUMLAH KARYAWAN SETIAP STATUSNYA
SELECT
	E.STATUS AS STATUS,
	COUNT(*) AS JUMLAH_KARYAWAN
FROM BIODATA B
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
GROUP BY STATUS;

--NOMOR 2 DATA BIODATA YANG BUKAN KARYAWAN
SELECT
	B.*
FROM BIODATA B
LEFT JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
WHERE E.ID IS NULL;

--NOMOR 3 FULLNAME, STATUS PERNIKAHAN, DAN JUMLAH ANAK
SELECT
	B.FIRST_NAME || ' ' || B.LAST_NAME AS FULL_NAME,
	CASE
		WHEN B.MARITAL_STATUS = TRUE THEN 'SUDAH MENIKAH'
		ELSE 'BELUM MENIKAH'
	END
	AS STATUS_PERNIKAHAN,
	SUM(CASE
		WHEN F.STATUS ILIKE 'ANAK' THEN 1
		ELSE 0
	END)
	AS JUMLAH_ANAK
FROM BIODATA B
LEFT JOIN FAMILY F
	ON B.ID = F.BIODATA_ID
GROUP BY FULL_NAME,STATUS_PERNIKAHAN;

--NOMOR 4 DATA DEPARTEMEN
SELECT
	*
FROM DEPARTMENT;

--NOMOR 5 TAHUN LAHIR DAN JUMLAH KARYAWAN YANG MEMILIKI TAHUN LAHIR YANG SAMA
SELECT
	DATE_PART('YEAR',TO_DATE(DOB,'YYYY-MM-DD')) AS TAHUN_LAHIR,
	COUNT(*) AS JUMLAH_KARYAWAN
FROM BIODATA B
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
WHERE E.ID IS NOT NULL
GROUP BY TAHUN_LAHIR;

--NOMOR 6 DATA BIODATA & JABATAN DARI KARYAWAN
SELECT
	B.*,
	P.NAME AS JABATAN
FROM BIODATA B
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
INNER JOIN EMPLOYEE_POSITION EP
	ON E.ID = EP.EMPLOYEE_ID
INNER JOIN POSITION P
	ON EP.POSITION_ID = P.ID;

--NOMOR 7 DATA BIODATA YANG LAHIR DI JAKARTA NAMUN TIDAK TINGGAL DI JAKARTA
SELECT
	B.*
FROM BIODATA B
WHERE B.POB ILIKE 'JAKARTA' AND B.ADDRESS NOT ILIKE '%JAKARTA';

--NOMOR 8 FULLNAME, JABATAN, USIA, DAN JUMLAH ANAK DARI MASING - MASING KARYAWAN (KALAU TIDAK ADA ANAK TULIS 0 ATAU -)
SELECT
	B.FIRST_NAME || ' ' || B.LAST_NAME AS FULLNAME,
	P.NAME AS JABATAN,
	DATE_PART('YEAR',AGE(NOW(),TO_DATE(DOB,'YYYY-MM-DD'))) AS USIA,
	SUM(CASE
			WHEN F.STATUS ILIKE 'ANAK' THEN 1 
			ELSE 0
	    END)
	AS JUMLAH_ANAK
FROM BIODATA B
LEFT JOIN FAMILY F
	ON B.ID = F.BIODATA_ID
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
INNER JOIN EMPLOYEE_POSITION EP
	ON E.ID = EP.EMPLOYEE_ID
INNER JOIN POSITION P
	ON EP.POSITION_ID = P.ID
GROUP BY FULLNAME, JABATAN, USIA;

--NOMOR 9 NAMA KARYAWAN DAN JUMLAH CUTI
SELECT
	B.FIRST_NAME || ' ' || B.LAST_NAME AS NAMA_KARYAWAN,
	COALESCE(SUM(DATE_PART('DAY',AGE(LR.END_DATE,LR.START_DATE))),0) AS "jumlah_cuti (day(s))"
FROM BIODATA B
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
LEFT JOIN LEAVE_REQUEST LR
	ON E.ID = LR.EMPLOYEE_ID
GROUP BY FULLNAME;

--NOMOR 10 NAMA KARYAWAN, JENIS PERJALANAN DINAS, TANGGAL PERJALANAN DINAS, DAN TOTAL PENGELUARANNYA SELAMA PERJALANAN DINAS
SELECT
	B.FIRST_NAME || ' ' || B.LAST_NAME AS NAMA_KARYAWAN,
	TT.NAME AS JENIS_PERJALANAN_DINAS,
	TR.START_DATE || ' s.d ' || TR.END_DATE AS TANGGAL_PERJALANAN_DINAS,
	TT.TRAVEL_FEE + SUM(TS.ITEM_COST) AS TOTAL_PENGELUARAN
FROM BIODATA B
INNER JOIN EMPLOYEE E
	ON B.ID = E.BIODATA_ID
INNER JOIN TRAVEL_REQUEST TR
	ON E.ID = TR.EMPLOYEE_ID
INNER JOIN TRAVEL_TYPE TT
	ON TR.TRAVEL_TYPE_ID = TT.ID
INNER JOIN TRAVEL_SETTLEMENT TS
	ON TR.ID = TS.TRAVEL_REQUEST_ID
GROUP BY NAMA_KARYAWAN, JENIS_PERJALANAN_DINAS, TANGGAL_PERJALANAN_DINAS, TT.TRAVEL_FEE;